enum discount_type {
  PERCENTAGE
  FIXED
}

enum media_type {
  IMAGE
  VIDEO
  DOCUMENT
  OTHER
}

enum order_status {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  RETURNED
}

enum payment_status {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum user_role {
  CUSTOMER
  ADMIN
  SUPER_ADMIN
  STAFF
}

table address {
  id text [pk, not null]
  street text [not null]
  city text [not null]
  province text [not null]
  postal_code text [not null]
  country text [not null]
  is_default boolean [default: false]
  user_id text [not null]
}

table attribute_value {
  id text [pk, not null]
  value text [not null]
  attribute_id text [not null]

  indexes {
    (attribute_id, value) [name: 'attribute_value_attribute_id_value_unique', unique]
  }
}

table attribute_value_to_variant {
  attribute_value_id text [not null]
  product_variant_id text [not null]

  indexes {
    (attribute_value_id, product_variant_id) [pk]
  }
}

table attribute {
  id text [pk, not null]
  name text [not null]

  indexes {
    name [name: 'attribute_name_unique', unique]
  }
}

table cart_item {
  id text [pk, not null]
  quantity integer [not null]
  cart_id text [not null]
  product_variant_id text [not null]

  indexes {
    (cart_id, product_variant_id) [name: 'cart_item_cart_id_product_variant_id_unique', unique]
  }
}

table cart {
  id text [pk, not null]
  user_id text [unique]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
}

table category {
  id text [pk, not null]
  name text [not null, unique]
  slug text [not null, unique]
  parent_id text

  indexes {
    parent_id [name: 'category_parent_idx']
  }
}

table coupon {
  id text [pk, not null]
  code text [not null, unique]
  discount_type discount_type [not null]
  value "double precision" [not null]
  expires_at timestamp [not null]
  is_active boolean [default: true]
}

table media {
  id text [pk, not null]
  file_name text [not null]
  url text [not null]
  file_type media_type [not null]
  size integer [not null]
  alt_text text
  folder_id text
  file_id text
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
}

table media_folder {
  id text [pk, not null]
  name text [not null]
  parent_id text
}

table order_item {
  id text [pk, not null]
  quantity integer [not null]
  price_at_purchase "double precision" [not null]
  order_id text [not null]
  product_variant_id text [not null]

  indexes {
    (order_id, product_variant_id) [name: 'order_item_order_id_product_variant_id_unique', unique]
  }
}

table order {
  id text [pk, not null]
  total_amount "double precision" [not null]
  status order_status [default: 'PENDING']
  user_id text [not null]
  shipping_address_id text [not null]
  coupon_id text
  discount_amount "double precision" [default: 0]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
}

table payment {
  id text [pk, not null]
  amount "double precision" [not null]
  status payment_status [default: 'PENDING']
  method text [not null]
  transaction_id text
  order_id text [not null, unique]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
}

table product_image {
  id text [pk, not null]
  display_order integer [default: 0]
  product_id text [not null]
  media_id text [not null, unique]

  indexes {
    (product_id, media_id) [name: 'product_image_product_id_media_id_unique', unique]
    product_id [name: 'product_image_product_idx']
  }
}

table product_variant {
  id text [pk, not null]
  sku text [not null, unique]
  price "double precision" [not null]
  stock_quantity integer [default: 0]
  product_id text [not null]

  indexes {
    product_id [name: 'product_variant_product_idx']
  }
}

table product {
  id text [pk, not null]
  name text [not null]
  slug text [not null, unique]
  description text [not null]
  category_id text [not null]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
}

table profiles {
  id text [pk, not null]
  first_name text [not null]
  last_name text [not null]
  phone text [unique]
  bio text [default: '']
  birthday timestamp [default: `now()`]
  user_id text [not null, unique]
}

table refresh_token {
  id text [pk, not null]
  token text [not null, unique]
  user_id text [not null]
  revoked boolean [not null, default: false]
  replaced_by_token text
  expires_at timestamp [not null]
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]

  indexes {
    user_id [name: 'refresh_token_userId_idx']
  }
}

table users {
  id text [pk, not null]
  name text [not null]
  email text [not null, unique]
  email_verified boolean [not null, default: false]
  verification_token text
  verification_token_expires timestamp
  avatar_url text
  role user_role [default: 'CUSTOMER']
  password text
  reset_password_token text
  reset_password_expires timestamp
  created_at timestamp [not null, default: `now()`]
  updated_at timestamp [not null, default: `now()`]
}

ref: address.user_id > users.id

ref: attribute_value.attribute_id > attribute.id

ref: attribute_value_to_variant.attribute_value_id > attribute_value.id

ref: attribute_value_to_variant.product_variant_id > product_variant.id

ref: cart_item.cart_id > cart.id

ref: cart_item.product_variant_id > product_variant.id

ref: cart.user_id - users.id

ref: category.parent_id > category.id

ref: media_folder.parent_id > media_folder.id

ref: media.folder_id > media_folder.id

ref: order_item.order_id > order.id

ref: order_item.product_variant_id > product_variant.id

ref: order.user_id > users.id

ref: order.shipping_address_id > address.id

ref: order.coupon_id > coupon.id

ref: payment.order_id - order.id

ref: product_image.product_id > product.id

ref: product_image.media_id - media.id

ref: product_variant.product_id > product.id

ref: product.category_id > category.id

ref: users.id - profiles.user_id